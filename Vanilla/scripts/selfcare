#!/usr/bin/emacs --script
(load (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory) nil 'nomessage)
(straight-use-package 'use-package)

(use-package modular-config
  :straight t
  )

(modular-config-load-modules '(space org))
(unless (shell-command-to-string "pgrep org")
(unless (string-match "org-google-tasks-get-tokens" (format "%s" timer-list))
  (run-at-time nil 3600  'org-google-tasks-get-tokens)))
(require 'notifications)
(with-current-buffer (find-file-noselect "~/Documents/Org/Agenda/selfcare.org")
  (let* ((Monday 2)
         (Tuesday 3)
         (Wednesday 4)
         (Thursday 5)
         (Friday 6)
         (Saturday 7)
         (Sunday 8)
         (day (format-time-string "%A" (current-time)))
         (xday '())
         (count '()))
  (setq xday (delete "" (org-table-get-remote-range "Plan" (concat "@2$" (format "%s" (symbol-value (intern day))) "..@>$" (format "%s" (symbol-value (intern day)))))))
  (setq xday (append xday (delete "" (org-table-get-remote-range "Plan" "@2$1..@>$1"))))
(unless (org-google-tasks-check-tasklist-today "Selfcare")
  (mapcar (lambda (x)
            (org-google-tasks-insert-remote-task (car (org-google-tasks-get-tasklist-id-by-name "Selfcare")) x "" (org-google-tasks-convert-time (current-time))  t)
            (message "%s" org-google-tasks-temp-task)
                  )  xday)
  
;; (require 'notifications)
(notifications-notify :app-name "Emacs" :title "Diet" :body (format "%s" (mapcar* (lambda (a b) (format "%s - %s\n" a b)) xday count)))
(princ (format "%s" (mapcar* (lambda (a b) (format "%s - %s\n" a b)) xday count)))
(unless (org-google-tasks-check-tasklist-today "Diet")
  (org-google-tasks-insert-list (mapcar* (lambda (a b) (format "%s - %s\n" a b)) xday count) "Exercises"))
(sleep-for 20)
)))
